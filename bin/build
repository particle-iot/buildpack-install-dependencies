#!/bin/bash

# Turn on extended glob
shopt -s extglob

cd $WORKSPACE_DIR

# Authenticate user
if [ -z $ACCESS_TOKEN ]; then
  echo "You need to provide ACCESS_TOKEN to install dependencies"
  exit -1
fi
mkdir ~/.particle
echo "{\"access_token\": \"${ACCESS_TOKEN}\", \"disableUpdateCheck\": true}" > ~/.particle/particle.config.json

# Make into an extended project if src doesn't exist
if [ -f project.properties ] && [ ! -d src ]; then
  mkdir src
  mv !(project.properties|src) src
fi

# Vendor all libraries
if [ -f project.properties ]; then
  particle library install --vendored -y
fi

# Copy workspace to output directory
cp -r $WORKSPACE_DIR/. $OUTPUT_DIR
